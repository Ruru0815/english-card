<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Dictionary & Exam Suite</title>
    <style>
        :root {
            --primary: #1d4ed8;
            --secondary: #f1f5f9;
            --text-main: #111827;
            --success: #22c55e;
            --error: #ef4444;
            --font-serif: 'Merriweather', serif;
            --font-sans: 'Segoe UI', Roboto, sans-serif;
        }

        body {
            font-family: var(--font-sans);
            margin: 0;
            background-color: #fff;
            color: var(--text-main);
            height: 100vh;
            overflow-x: hidden;
            transition: box-shadow 0.3s ease;
        }

        .glow-success { box-shadow: inset 0 0 50px var(--success) !important; }
        .glow-error { box-shadow: inset 0 0 50px var(--error) !important; }

        /* Navbar */
        .navbar {
            background: #fff; border-bottom: 1px solid #e5e7eb; padding: 15px 40px;
            display: flex; justify-content: space-between; align-items: center;
            position: fixed; top: 0; width: 100%; box-sizing: border-box; z-index: 100;
        }
        .logo { font-family: var(--font-serif); font-weight: 900; font-size: 24px; color: var(--primary); }
        
        /* Âè≥‰∏äËßíÊåâÈàïÁæ§ÁµÑ */
        .nav-actions {
            display: flex;
            align-items: center;
            gap: 12px; /* ÊåâÈàï‰πãÈñìÁöÑË∑ùÈõ¢ */
        }

        .nav-btn {
            background: white; border: 1px solid #e5e7eb; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600;
            display: flex; align-items: center; gap: 8px; transition: all 0.2s; font-size: 14px;
            text-decoration: none; /* ÁÇ∫‰∫ÜËÆì a Ê®ôÁ±§ÂÉèÊåâÈàï */
            color: var(--text-main);
        }
        .nav-btn:hover { background: var(--secondary); }

        /* ÈªÉËâ≤ÊúüÊú´ËÄÉÊåâÈàïÊ®£Âºè */
        .btn-final {
            background-color: #eab308; 
            color: black;
            border: 1px solid #ca8a04;
        }
        .btn-final:hover { background-color: #ca8a04; }

        .badge { background: var(--primary); color: white; padding: 2px 6px; border-radius: 10px; font-size: 11px; }

        /* Sidebar */
        .sidebar {
            position: fixed; top: 0; right: -350px; width: 300px; height: 100vh; background: #f9fafb;
            border-left: 1px solid #e5e7eb; transition: right 0.3s ease; z-index: 200;
            display: flex; flex-direction: column; padding: 20px; box-sizing: border-box;
            box-shadow: -5px 0 15px rgba(0,0,0,0.05);
        }
        .sidebar.open { right: 0; }
        .list-item { background: white; border: 1px solid #e5e7eb; padding: 10px; margin-bottom: 8px; border-radius: 6px; cursor: pointer; display: flex; justify-content: space-between; }
        
        .sidebar-btn {
            width: 100%; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-bottom: 10px; display: block; text-align: center; text-decoration: none; font-size: 14px;
        }
        .btn-test { background: var(--text-main); color: white; }

        /* Main View */
        .container { margin-top: 80px; max-width: 800px; margin-left: auto; margin-right: auto; padding: 20px; }
        .search-input { width: 100%; padding: 20px; font-size: 20px; border: 2px solid #e5e7eb; border-radius: 8px; outline: none; }
        .entry-container { display: none; margin-top: 30px; }
        .headword { font-family: var(--font-serif); font-size: 48px; font-weight: 700; margin: 0; }
        .phonetic-group { display: flex; align-items: center; gap: 10px; background: #f3f4f6; padding: 5px 15px; border-radius: 20px; margin-top: 10px; width: fit-content; }
        .definition { font-weight: 600; font-size: 18px; margin-bottom: 5px; margin-top: 10px; }
        .definition::before { content: "‚Ä¢ "; color: var(--primary); }

        /* Exam Overlays */
        .exam-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 300;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        .mode-select-box { text-align: center; }
        .mode-btn {
            display: block; width: 200px; padding: 20px; margin: 10px auto;
            border: 2px solid var(--primary); border-radius: 12px; background: white;
            font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .mode-btn:hover { background: var(--primary); color: white; }
        .exam-box { text-align: center; width: 90%; max-width: 500px; }
        .audio-big-btn {
            width: 100px; height: 100px; border-radius: 50%; background: var(--primary); color: white;
            font-size: 40px; border: none; cursor: pointer; margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(29, 78, 216, 0.3); transition: transform 0.1s;
        }
        .audio-big-btn:active { transform: scale(0.95); }
        .black-box-mask {
            background-color: black; color: black; padding: 10px 20px; border-radius: 8px; user-select: none;
            display: inline-block; font-size: 40px; font-weight: bold; font-family: var(--font-serif); min-width: 200px;
        }
        .revealed { background-color: transparent; color: var(--text-main); }
        .type-input {
            font-size: 32px; text-align: center; padding: 10px; border: none; border-bottom: 3px solid #ddd;
            outline: none; width: 100%; font-family: var(--font-serif); font-weight: bold; text-transform: lowercase;
        }
        .judge-btns { display: none; gap: 20px; justify-content: center; margin-top: 30px; }
        .btn-judge { padding: 15px 30px; font-size: 18px; border-radius: 30px; border: none; cursor: pointer; font-weight: bold; color: white; }
        .btn-yes { background: var(--success); }
        .btn-no { background: var(--error); }
        .result-box { text-align: center; width: 90%; max-width: 600px; }
        .score-circle {
            width: 150px; height: 150px; border-radius: 50%; border: 10px solid var(--primary);
            display: flex; align-items: center; justify-content: center; margin: 0 auto 30px;
            font-size: 40px; font-weight: 900; color: var(--primary);
        }
        .wrong-list { text-align: left; max-height: 300px; overflow-y: auto; background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .wrong-item { border-bottom: 1px solid #ddd; padding: 8px 0; color: var(--error); font-weight: bold; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="logo">Dictionary</div>
        
        <div class="nav-actions">
            <a href="final_exam.html" class="nav-btn btn-final">
                Final Exam ‚úàÔ∏è
            </a>

            <button class="nav-btn" onclick="toggleSidebar()">
                Saved <span class="badge" id="badge-count">0</span>
            </button>
        </div>
    </nav>

    <div class="sidebar" id="sidebar">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px; padding-bottom:10px; border-bottom:1px solid #eee;">
            <h3>Word List</h3>
            <button onclick="toggleSidebar()" style="border:none; background:none; font-size:24px; cursor:pointer;">√ó</button>
        </div>
        
        <button class="sidebar-btn btn-test" onclick="showExamSetup()">
            Start Vocabulary Test üéì
        </button>

        <div id="saved-list" style="flex:1; overflow-y:auto; margin-top:10px; border-top:1px solid #eee;"></div>
        <button onclick="clearAll()" style="color:red; background:none; border:1px solid red; padding:5px; margin-top:10px; cursor:pointer; width:100%;">Clear All</button>
    </div>

    <div class="container" id="main-view">
        <input type="text" class="search-input" id="word-input" placeholder="Type a word..." onkeydown="if(event.key==='Enter') searchWord()">
        <div class="entry-container" id="entry-result">
            <h1 class="headword" id="disp-word">Word</h1>
            <div class="phonetic-group">
                <span id="disp-phonetic">/ ... /</span>
                <button onclick="playAudio()" style="background:none; border:none; cursor:pointer; font-size:20px;">üîä</button>
            </div>
            <div id="meanings-area"></div>
        </div>
    </div>

    <div class="exam-overlay" id="exam-setup">
        <div class="mode-select-box">
            <h1>Choose Exam Mode</h1>
            <button class="mode-btn" onclick="startExam('listening')">üëÇ Listening Mode<br><span style="font-size:12px; color:#666;">Black box + Self check</span></button>
            <button class="mode-btn" onclick="startExam('typing')">‚å®Ô∏è Typing Mode<br><span style="font-size:12px; color:#666;">Type what you hear</span></button>
            <button onclick="closeExam()" style="margin-top:20px; background:none; border:none; text-decoration:underline; cursor:pointer;">Cancel</button>
        </div>
    </div>

    <div class="exam-overlay" id="exam-active">
        <div class="exam-box">
            <button class="audio-big-btn" onclick="playExamAudio()">üîä</button>
            <div id="mode-listen-area" style="display:none;">
                <div id="listen-black-box" class="black-box-mask">WORD</div>
                <div style="margin-top:40px;"><button id="btn-reveal" onclick="revealListening()" style="padding:10px 30px; font-size:16px; cursor:pointer;">Show Answer</button></div>
                <div class="judge-btns" id="judge-btns">
                    <button class="btn-judge btn-no" onclick="handleJudge(false)">‚ùå Forgot</button>
                    <button class="btn-judge btn-yes" onclick="handleJudge(true)">‚úÖ Correct</button>
                </div>
            </div>
            <div id="mode-type-area" style="display:none;">
                <input type="text" id="type-input" class="type-input" placeholder="Type here..." autocomplete="off" onkeydown="if(event.key==='Enter') checkTyping()">
                <div style="margin-top:20px; color:#999; font-size:14px;">Press Enter to check</div>
            </div>
            <div style="margin-top:30px; color:#ccc;"><span id="q-current">1</span> / <span id="q-total">10</span></div>
            <button onclick="closeExam()" style="margin-top:20px; background:none; border:none; color:#999; cursor:pointer;">Exit</button>
        </div>
    </div>

    <div class="exam-overlay" id="result-view">
        <div class="result-box">
            <h1>Results</h1>
            <div class="score-circle"><span id="result-score">0%</span></div>
            <div style="display:flex; justify-content:space-around; margin-bottom:20px;">
                <div style="color:var(--success); font-weight:bold;">Correct: <span id="res-correct">0</span></div>
                <div style="color:var(--error); font-weight:bold;">Wrong: <span id="res-wrong">0</span></div>
            </div>
            <h3>Mistakes Review</h3>
            <div class="wrong-list" id="wrong-container"></div>
            <button onclick="closeExam()" style="padding:15px 40px; background:var(--primary); color:white; border:none; border-radius:30px; font-size:18px; cursor:pointer;">Close</button>
        </div>
    </div>

    <script>
        let myWords = JSON.parse(localStorage.getItem('dictWords')) || [];
        let currentAudio = null;
        let examQueue = [];
        let examIndex = 0;
        let examMode = '';
        let correctCount = 0;
        let wrongWordsList = [];

        updateBadge();
        renderList();

        async function searchWord() {
            const input = document.getElementById('word-input');
            const word = input.value.trim();
            if(!word) return;
            try {
                const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                if(!res.ok) throw new Error();
                const data = await res.json();
                const entry = data[0];
                document.getElementById('disp-word').textContent = entry.word;
                let audioSrc = null;
                const usAudio = entry.phonetics.find(p => p.audio && p.audio.includes('-us.mp3')) || entry.phonetics.find(p => p.audio);
                if(usAudio) audioSrc = usAudio.audio;
                currentAudio = audioSrc;
                document.getElementById('disp-phonetic').textContent = entry.phonetic || "";
                document.getElementById('meanings-area').innerHTML = entry.meanings.map(m => `<div><span style="font-style:italic;color:#666;">${m.partOfSpeech}</span><div class="definition">${m.definitions[0].definition}</div></div>`).join('');
                document.getElementById('entry-result').style.display = 'block';
                input.value = '';
                const newWord = { id: Date.now(), word: entry.word, audio: audioSrc };
                myWords = myWords.filter(w => w.word.toLowerCase() !== newWord.word.toLowerCase());
                myWords.unshift(newWord);
                localStorage.setItem('dictWords', JSON.stringify(myWords));
                renderList(); updateBadge();
            } catch(e) { alert("Word not found"); }
        }

        function playAudio() { if(currentAudio) new Audio(currentAudio).play(); }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
        function renderList() {
            const el = document.getElementById('saved-list'); el.innerHTML='';
            myWords.forEach(w => {
                const div = document.createElement('div'); div.className='list-item';
                div.innerHTML=`<span onclick="loadFromList('${w.word}')">${w.word}</span> <span onclick="delWord(${w.id})" style="color:red">√ó</span>`;
                el.appendChild(div);
            });
        }
        function loadFromList(w) { document.getElementById('word-input').value=w; searchWord(); toggleSidebar(); }
        function delWord(id) { myWords=myWords.filter(w=>w.id!==id); localStorage.setItem('dictWords',JSON.stringify(myWords)); renderList(); updateBadge(); }
        function clearAll() { if(confirm("Clear?")){myWords=[];localStorage.setItem('dictWords','[]');renderList();updateBadge();} }
        function updateBadge() { document.getElementById('badge-count').textContent = myWords.length; }

        function showExamSetup() {
            if(myWords.length === 0) return alert("Please search and save words first!");
            toggleSidebar(); document.getElementById('main-view').style.display = 'none'; document.getElementById('exam-setup').style.display = 'flex';
        }
        function startExam(mode) {
            examMode = mode; examQueue = [...myWords].sort(() => Math.random() - 0.5); examIndex = 0; correctCount = 0; wrongWordsList = [];
            document.getElementById('exam-setup').style.display = 'none'; document.getElementById('exam-active').style.display = 'flex';
            document.getElementById('mode-listen-area').style.display = (mode === 'listening') ? 'block' : 'none';
            document.getElementById('mode-type-area').style.display = (mode === 'typing') ? 'block' : 'none';
            loadQuestion();
        }
        function loadQuestion() {
            if(examIndex >= examQueue.length) { showResults(); return; }
            const currentItem = examQueue[examIndex];
            document.getElementById('q-current').textContent = examIndex + 1; document.getElementById('q-total').textContent = examQueue.length;
            if(examMode === 'listening') {
                const box = document.getElementById('listen-black-box'); box.textContent = currentItem.word; box.classList.remove('revealed');
                document.getElementById('btn-reveal').style.display = 'inline-block'; document.getElementById('judge-btns').style.display = 'none';
            } else {
                const input = document.getElementById('type-input'); input.value = ''; input.focus();
            }
            setTimeout(playExamAudio, 500);
        }
        function playExamAudio() { const item = examQueue[examIndex]; if(item.audio) new Audio(item.audio).play(); }
        function checkTyping() {
            const input = document.getElementById('type-input');
            if(input.value.trim().toLowerCase() === examQueue[examIndex].word.toLowerCase()) { triggerFeedback('success'); correctCount++; }
            else { triggerFeedback('error'); wrongWordsList.push(examQueue[examIndex]); }
            setTimeout(() => { examIndex++; loadQuestion(); }, 1000);
        }
        function revealListening() { document.getElementById('listen-black-box').classList.add('revealed'); document.getElementById('btn-reveal').style.display = 'none'; document.getElementById('judge-btns').style.display = 'flex'; }
        function handleJudge(isCorrect) {
            if(isCorrect) { triggerFeedback('success'); correctCount++; } else { triggerFeedback('error'); wrongWordsList.push(examQueue[examIndex]); }
            setTimeout(() => { examIndex++; loadQuestion(); }, 800);
        }
        function triggerFeedback(type) {
            const className = type === 'success' ? 'glow-success' : 'glow-error'; document.body.classList.add(className);
            setTimeout(() => { document.body.classList.remove(className); }, 800);
        }
        function showResults() {
            document.getElementById('exam-active').style.display = 'none'; document.getElementById('result-view').style.display = 'flex';
            document.getElementById('res-correct').textContent = correctCount; document.getElementById('res-wrong').textContent = wrongWordsList.length;
            document.getElementById('result-score').textContent = (Math.round((correctCount / examQueue.length) * 100) || 0) + '%';
            const container = document.getElementById('wrong-container'); container.innerHTML = '';
            if(wrongWordsList.length === 0) container.innerHTML = '<div style="color:green">Perfect Score! üéâ</div>';
            else wrongWordsList.forEach(w => { const div = document.createElement('div'); div.className = 'wrong-item'; div.textContent = w.word; container.appendChild(div); });
        }
        function closeExam() {
            document.getElementById('exam-setup').style.display = 'none'; document.getElementById('exam-active').style.display = 'none';
            document.getElementById('result-view').style.display = 'none'; document.getElementById('main-view').style.display = 'block';
        }
    </script>
</body>
</html>
